<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>GUAâ€™Ä¨ APP | Presupuesto TÃ©cnico</title>

<link rel="manifest" href="manifiesto.json">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
 @media print {
  .pdf-header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    background: #ffffff;
    z-index: 1000;
    page-break-inside: avoid;
  }

  #pdf {
    padding-top: 120px;
  }
}
body{margin:0;font-family:Arial;background:#f4f6f8}
.container{max-width:800px;margin:auto;background:#fff}
.header{background:#0b5ed7;color:#fff;text-align:center;padding:16px}
.header img{height:70px}
.card{margin:16px;padding:16px;border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,.1)}
input{width:100%;padding:8px;margin-top:6px}
button{width:100%;padding:14px;margin-top:10px;border:none;border-radius:8px;font-weight:bold}
.blue{background:#0b5ed7;color:#fff}
.green{background:#28a745;color:#fff}
.gray{background:#6c757d;color:#fff}
.footer{text-align:center;font-size:11px;color:#444;padding:20px}
.hidden{display:none}
#pdf table {
  width: 100%;
  border-collapse: collapse;
  table-layout: fixed;
}

#pdf th,
#pdf td {
  border: 1px solid #333;
  padding: 6px 8px;
  font-size: 11px;
  word-wrap: break-word;
}
  #pdf th:nth-child(2),
#pdf td:nth-child(2) {
  text-align: right;
  width: 35%;
}
  <tr class="subtotal">
  <td>Subtotal</td>
  <td id="pdfSub"></td>
</tr>
<tr class="iva">
  <td>IVA 10%</td>
  <td id="pdfIva"></td>
</tr>
<tr class="total-final">
  <td>Total</td>
  <td id="pdfTotal"></td>
</tr>

#pdf th:nth-child(1),
#pdf td:nth-child(1) {
  width: 65%;
}
/* ===== PDF TAMAÃ‘O OFICIO (LEGAL) ===== */
#pdf{
  width: 216mm;
  min-height: 356mm;
  padding: 20mm;
  margin: 0 auto;
  background: #ffffff;
  box-sizing: border-box;
  font-size: 12px;
  color: #000;
}
</style>
</head>

<body>

<div id="pdf">
  
<div class="pdf-header">
  <img src="logotipo-guaiapp.png" class="logo-left">
  <div class="header-text">
    <h2>Presupuesto TÃ©cnico</h2>
    <div>NÂ°: <span id="nPresupuesto"></span></div>
    <div>Fecha: <span id="fecha"></span></div>
    <div>VÃ¡lido hasta: <span id="vence"></span></div>
  </div>
  <img src="logo-tecnico.png" class="logo-right">
</div>

<div class="card">
  <input id="cliente" placeholder="Cliente">
  <input id="rucCliente" placeholder="RUC Cliente">
  <input id="telCliente" placeholder="TelÃ©fono Cliente">
  <input id="tecnico" placeholder="TÃ©cnico Responsable">
  <input id="telTecnico" placeholder="TelÃ©fono TÃ©cnico">
  <input id="empresa" placeholder="Empresa / Taller">
</div>

<div class="card">
  <input id="s1" placeholder="Mantenimiento preventivo Gs">
  <input id="s2" placeholder="Mantenimiento correctivo Gs">
  <input id="s3" placeholder="Carga de gas Gs">
  <input id="desc4" placeholder="Otro servicio">
  <input id="s4" placeholder="Precio otro servicio Gs">
</div>

<div class="card">
  <div><b>Subtotal:</b> Gs. <span id="sub">0</span></div>
  <div><b>IVA 10%:</b> Gs. <span id="iva">0</span></div>
  <div style="font-size:18px"><b>Total:</b> Gs. <span id="total">0</span></div>
</div>

<div class="card">

  <button class="btn blue" onclick="calcular()">
    ðŸ”„ Calcular
  </button>

  <button class="btn green" onclick="downloadPDF()">
    ðŸ“„ Descargar PDF Profesional
  </button>

  <button class="btn whatsapp" onclick="enviarWhats()">
    ðŸ’¬ Enviar por WhatsApp
  </button>

  <button id="btnInstalar" class="btn gray" style="display:none">
    ðŸ“² Instalar App
  </button>

  <button class="btn gray" onclick="compartir()">
    ðŸ”— Compartir App
  </button>

</div>

<div class="footer">
<b>GUAâ€™Ä¨ APP</b><br>
Desarrollado por <b>RHAB Tech</b> â€“ DivisiÃ³n de <b>RHAB INTERNATIONAL TRADING</b><br>
San Lorenzo â€“ Paraguay Â· Alberto SÃ¡nchez BenÃ­tez 9998<br>
ðŸ“§ guaiapp@rhabinternationaltrading.com
</div>

</div>

<br>

<table>
<tr><th>DescripciÃ³n</th><th>Importe</th></tr>
<tr><td>Mantenimiento preventivo</td><td id="ps1"></td></tr>
<tr><td>Mantenimiento correctivo</td><td id="ps2"></td></tr>
<tr><td>Carga de gas</td><td id="ps3"></td></tr>
<tr><td id="pdesc4"></td><td id="ps4"></td></tr>
<tr><td><b>Subtotal</b></td><td id="psub"></td></tr>
<tr><td><b>IVA 10%</b></td><td id="piva"></td></tr>
<tr><td><b>Total</b></td><td id="ptotal"></td></tr>
</table>

<p><b>GarantÃ­a:</b> 3 meses sobre el servicio realizado.</p>

<p style="font-size:11px">
RHAB Tech â€“ RHAB INTERNATIONAL TRADING<br>
San Lorenzo â€“ Paraguay Â· Alberto SÃ¡nchez BenÃ­tez 9998<br>
guaiapp@rhabinternationaltrading.com
</p>
</div>

<script>
  
function calcular(){
  let total=(+s1.value||0)+(+s2.value||0)+(+s3.value||0)+(+s4.value||0);
  let sub=total/1.1;
  let iva=total-sub;
  sub=Math.round(sub); iva=Math.round(iva);

  document.getElementById("sub").innerText=sub.toLocaleString("es-PY");
  document.getElementById("iva").innerText=iva.toLocaleString("es-PY");
  document.getElementById("total").innerText=total.toLocaleString("es-PY");
}

function exportPDF(){
  calcular();
  let n="GUA-"+Date.now();
  let f=new Date(); let v=new Date(); v.setDate(f.getDate()+7);

  pnum.innerText=n;
  pfecha.innerText=f.toLocaleDateString();
  pvence.innerText=v.toLocaleDateString();

  pcliente.innerText=cliente.value;
  pruc.innerText=rucCliente.value;
  ptel.innerText=telCliente.value;
  ptecnico.innerText=tecnico.value;
  pempresa.innerText=empresa.value;

  ps1.innerText=s1.value;
  ps2.innerText=s2.value;
  ps3.innerText=s3.value;
  pdesc4.innerText=desc4.value;
  ps4.innerText=s4.value;

  psub.innerText=sub.innerText;
  piva.innerText=iva.innerText;
  ptotal.innerText=total.innerText;

  pdf.classList.remove("hidden");
  html2pdf().from(pdf).save("Presupuesto_"+n+".pdf").then(()=>pdf.classList.add("hidden"));
}
  
function sendWhats() {
  const cliente = document.getElementById("cliente").value || "â€”";
  const ruc = document.getElementById("ruc")?.value || "â€”";
  const telCliente = document.getElementById("tel_cliente")?.value || "â€”";
  const tecnico = document.getElementById("tecnico").value || "â€”";
  const empresa = document.getElementById("empresa").value || "â€”";

  const subtotal = calc();
  if (subtotal <= 0) {
    alert("Debe cargar al menos un servicio.");
    return;
  }

  const iva = Math.round(subtotal / 11);
  const total = subtotal;

  const fecha = new Date();
  const fechaStr = fecha.toLocaleDateString("es-PY");
  const venc = new Date(fecha);
  venc.setDate(venc.getDate() + 7);
  const vencStr = venc.toLocaleDateString("es-PY");

  const nro = "GUA-" +
    fecha.getFullYear() +
    String(fecha.getMonth()+1).padStart(2,"0") +
    String(fecha.getDate()).padStart(2,"0") +
    "-" +
    Math.floor(Math.random()*9000+1000);

  let msg = "";
  msg += "ðŸ“„ *PRESUPUESTO TÃ‰CNICO â€“ GUAâ€™Ä¨ APP*%0A%0A";
  msg += `Cliente: ${cliente}%0A`;
  msg += `RUC: ${ruc}%0A`;
  msg += `TelÃ©fono: ${telCliente}%0A%0A`;
  msg += `TÃ©cnico: ${tecnico}%0A`;
  msg += `Empresa: ${empresa}%0A%0A`;
  msg += `Fecha: ${fechaStr}%0A`;
  msg += `VÃ¡lido hasta: ${vencStr}%0A`;
  msg += `NÂ° Presupuesto: ${nro}%0A%0A`;
  msg += "ðŸ› ï¸ *DETALLE DE SERVICIOS*%0A";

  if (s1.value > 0) msg += `â€¢ Mantenimiento preventivo: Gs. ${s1.value}%0A`;
  if (s2.value > 0) msg += `â€¢ Mantenimiento correctivo: Gs. ${s2.value}%0A`;
  if (s3.value > 0) msg += `â€¢ Carga de gas: Gs. ${s3.value}%0A`;
  if (s4.value > 0) msg += `â€¢ ${desc_otro.value || "Otro servicio"}: Gs. ${s4.value}%0A`;

  msg += "%0Aâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”%0A";
  msg += `Subtotal: Gs. ${(total-iva).toLocaleString("es-PY")}%0A`;
  msg += `IVA 10% incluido: Gs. ${iva.toLocaleString("es-PY")}%0A`;
  msg += `ðŸ’° *TOTAL A PAGAR: Gs. ${total.toLocaleString("es-PY")}*%0A`;
  msg += "â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”%0A%0A";
  msg += "ðŸ›¡ï¸ GarantÃ­a: 7 dÃ­as sobre el servicio realizado.%0A%0A";
  msg += "ðŸ“ *RHAB Tech â€“ DivisiÃ³n tecnolÃ³gica de RHAB INTERNATIONAL TRADING*%0A";
  msg += "San Lorenzo â€“ Paraguay%0A";
  msg += "ðŸ“§ guaiapp@rhabinternationaltrading.com%0A%0A";
  msg += "_Generado automÃ¡ticamente por GUAâ€™Ä¨ APP_";
  window.open("https://wa.me/?text=" + msg, "_blank");
}
function compartir(){
  if(navigator.share){
    navigator.share({title:"GUAâ€™Ä¨ APP",url:location.href});
  }else alert("Compartir no disponible");
}

// PWA
let deferredPrompt;
window.addEventListener("beforeinstallprompt",e=>{
  e.preventDefault();
  deferredPrompt=e;
  btnInstalar.style.display="block";
});
btnInstalar.onclick=()=>{deferredPrompt.prompt();};
  /*************** PDF PROFESIONAL ****************/
function downloadPDF(){

  const pdf = document.getElementById("pdf");

  if(!pdf){
    alert("No se encontrÃ³ el contenedor PDF");
    return;
  }

  const nro = document.getElementById("nPresupuesto")?.innerText || Date.now();

  html2pdf().set({
    margin: [10, 10, 15, 10], // top, left, bottom, right
    filename: "Presupuesto_GUAI_APP_" + nro + ".pdf",
    image: { type: "jpeg", quality: 0.98 },
    html2canvas: {
      scale: 2,
      useCORS: true,
      allowTaint: true,
      backgroundColor: "#ffffff"
    },
   jsPDF: {
  unit: "mm",
  format: [216, 356], // OFICIO / LEGAL real
  orientation: "portrait"
   }
  }).from(pdf).save();
}
  
// SW
if("serviceWorker"in navigator){navigator.serviceWorker.register("sw.js");}
</script>

</body>
</html>
