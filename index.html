<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GUA'ÃŒ APP â€“ Presupuesto TÃ©cnico</title>

<!-- PWA -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0b5ed7">

<style>
body{
  font-family:system-ui,Arial;
  background:#f4f6f9;
  margin:0;
  padding:0;
}
.header{
  background:#0b5ed7;
  text-align:center;
  padding:20px;
}
.header img{
  width:220px;
  max-width:90%;
}
.container{
  padding:16px;
  max-width:700px;
  margin:auto;
}
.card{
  background:#fff;
  border-radius:14px;
  padding:16px;
  margin-bottom:16px;
  box-shadow:0 2px 8px rgba(0,0,0,.08);
}
button{
  width:100%;
  padding:14px;
  margin-top:10px;
  border:none;
  border-radius:12px;
  font-size:15px;
  font-weight:600;
}
.btn-main{background:#0b5ed7;color:#fff;}
.btn-pdf{background:#28a745;color:#fff;}
.btn-wa{background:#25D366;color:#fff;}
.btn-gray{background:#6c757d;color:#fff;}
footer{
  text-align:center;
  font-size:13px;
  color:#555;
  margin:20px 0;
}
</style>
</head>

<body>

<!-- HEADER -->
<div class="header">
  <img src="logo-guaiapp.png" alt="Gua'Ã¬ APP">
</div>

<div class="container">

<div class="card">
<h3>Presupuesto TÃ©cnico de ClimatizaciÃ³n</h3>
<input id="tecnico" placeholder="Nombre del tÃ©cnico" style="width:100%;padding:10px;margin-top:6px">
<input id="cliente" placeholder="Nombre del cliente" style="width:100%;padding:10px;margin-top:6px">
</div>

<div class="card">
<h3>Servicios</h3>

<label><input type="checkbox" class="srv" data-nombre="Mantenimiento preventivo"> Mantenimiento preventivo</label>
<input type="number" class="precio" placeholder="Precio Gs.">

<label><input type="checkbox" class="srv" data-nombre="Mantenimiento correctivo"> Mantenimiento correctivo</label>
<input type="number" class="precio" placeholder="Precio Gs.">

<label><input type="checkbox" class="srv" data-nombre="Carga de gas"> Carga de gas</label>
<input type="number" class="precio" placeholder="Precio Gs.">

<label><input type="checkbox" class="srv" data-nombre="Otro servicio"> Otro servicio</label>
<input type="number" class="precio" placeholder="Precio Gs.">

<p><strong>Total:</strong> <span id="total">Gs. 0</span></p>

<button class="btn-main" onclick="calcular()">Calcular total</button>
<button class="btn-pdf" onclick="descargarPDF()">Descargar PDF</button>
<button class="btn-wa" onclick="enviarWhatsApp()">Enviar por WhatsApp</button>

<hr>

<button id="btnInstall" class="btn-gray" style="display:none" onclick="instalarApp()">ðŸ“² Instalar App</button>
<button class="btn-gray" onclick="compartirApp()">ðŸ”— Compartir App</button>

</div>

<footer>
Generado a travÃ©s de <strong>GUAâ€™ÃŒ APP</strong><br>
Plataforma digital de presupuestos tÃ©cnicos de climatizaciÃ³n<br>
Desarrollado por RHAB Tech â€“ RHAB INTERNATIONAL TRADING<br>
guaiapp@rhabinternationaltrading.com Â· info@rhabinternationaltrading.com
</footer>

</div>

<!-- PDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
/* ===== CÃLCULO ===== */
let detalle=[], total=0, nro=Number(localStorage.getItem("guai_nro")||0)+1;
localStorage.setItem("guai_nro",nro);

function calcular(){
  detalle=[]; total=0;
  document.querySelectorAll(".srv").forEach((c,i)=>{
    const p=document.querySelectorAll(".precio")[i].value;
    if(c.checked && p){
      total+=Number(p);
      detalle.push(`${c.dataset.nombre} â€“ Gs. ${p}`);
    }
  });
  document.getElementById("total").innerText="Gs. "+total;
}

/* ===== PDF ===== */
function descargarPDF(){
  calcular();
  if(!detalle.length) return alert("AgregÃ¡ servicios");
  const {jsPDF}=window.jspdf;
  const doc=new jsPDF();
  doc.addImage("logo-guaiapp.png","PNG",60,10,90,40);
  doc.text("PRESUPUESTO TÃ‰CNICO DE SERVICIOS DE CLIMATIZACIÃ“N",20,60);
  doc.text("Generado a travÃ©s de GUAâ€™ÃŒ APP",20,68);
  doc.text(`Presupuesto NÂ° ${nro}`,20,80);
  doc.text(`Cliente: ${cliente.value}`,20,88);
  doc.text(`TÃ©cnico: ${tecnico.value}`,20,96);
  let y=110;
  detalle.forEach((d,i)=>{doc.text((i+1)+". "+d,20,y);y+=7});
  doc.text(`TOTAL: Gs. ${total}`,20,y+10);
  doc.save("Presupuesto_"+nro+".pdf");
}

/* ===== WHATSAPP ===== */
function enviarWhatsApp(){
  calcular();
  let msg=`Presupuesto TÃ©cnico â€“ GUAâ€™ÃŒ APP\nCliente: ${cliente.value}\nTÃ©cnico: ${tecnico.value}\n\n`;
  detalle.forEach((d,i)=>msg+=(i+1)+". "+d+"\n");
  msg+=`\nTOTAL: Gs. ${total}`;
  window.open("https://wa.me/?text="+encodeURIComponent(msg));
}

/* ===== COMPARTIR ===== */
function compartirApp(){
  if(navigator.share){
    navigator.share({
      title:"GUAâ€™ÃŒ APP",
      text:"Presupuestos tÃ©cnicos profesionales",
      url:location.href
    });
  }else{
    alert("CopiÃ¡ este link:\n"+location.href);
  }
}

/* ===== SERVICE WORKER ===== */
if("serviceWorker" in navigator){
  window.addEventListener("load",()=>{
    navigator.serviceWorker.register("sw.js");
  });
}

/* ===== INSTALAR APP (ANDROID) ===== */
let deferredPrompt;
window.addEventListener("beforeinstallprompt",(e)=>{
  e.preventDefault();
  deferredPrompt=e;
  document.getElementById("btnInstall").style.display="block";
});

function instalarApp(){
  if(!deferredPrompt){
    alert("En iPhone: usar 'Agregar a pantalla de inicio'");
    return;
  }
  deferredPrompt.prompt();
  deferredPrompt.userChoice.then(()=>deferredPrompt=null);
}
</script>

</body>
</html>
