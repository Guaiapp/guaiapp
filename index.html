<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GUAâ€™ÃŒ APP</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0d6efd">

<style>
body{font-family:Arial;background:#f4f6f8;margin:0;padding:20px}
.card{background:#fff;border-radius:12px;padding:20px;box-shadow:0 2px 8px rgba(0,0,0,.1);margin-bottom:20px}
button{width:100%;padding:14px;margin:8px 0;font-size:16px;border:none;border-radius:10px;color:#fff;cursor:pointer}
.blue{background:#0d6efd}
.green{background:#28a745}
.green2{background:#2ecc71}
.gray{background:#6c757d}
input{width:100%;padding:10px;margin:6px 0;border-radius:8px;border:1px solid #ccc}
h2{margin-top:0}
small{color:#555}
</style>
</head>

<body>

<div class="card">
<input id="cliente" placeholder="Nombre del cliente">

<h2>Servicios</h2>

<label><input type="checkbox" class="srv" data-name="Mantenimiento preventivo"> Mantenimiento preventivo</label>
<input type="number" class="price" placeholder="Precio Gs.">

<label><input type="checkbox" class="srv" data-name="Mantenimiento correctivo"> Mantenimiento correctivo</label>
<input type="number" class="price" placeholder="Precio Gs.">

<label><input type="checkbox" class="srv" data-name="Carga de gas"> Carga de gas</label>
<input type="number" class="price" placeholder="Precio Gs.">

<label><input type="checkbox" class="srv" data-name="Otro servicio"> Otro servicio</label>
<input type="number" class="price" placeholder="Precio Gs.">

<h3>Total: Gs. <span id="total">0</span></h3>

<button class="blue" onclick="calcular()">Calcular total</button>
<button class="green" onclick="descargarPDF()">Descargar PDF</button>
<button class="green2" onclick="enviarWhatsApp()">Enviar por WhatsApp</button>

<button id="btnInstall" class="gray">ðŸ“² Instalar App</button>
<button class="gray" onclick="compartir()">ðŸ”— Compartir App</button>
</div>

<div class="card">
<h2>Historial Empresa</h2>
<button class="gray" onclick="verHistorial()">Ver historial</button>
<button class="gray" onclick="exportarCSV()">Exportar CSV</button>
<button class="gray" onclick="borrarHistorial()">Borrar historial</button>
</div>

<small>
Generado a travÃ©s de <b>GUAâ€™ÃŒ APP</b><br>
Plataforma digital de presupuestos tÃ©cnicos de climatizaciÃ³n<br>
Desarrollado por RHAB Tech â€“ RHAB INTERNATIONAL TRADING
</small>

<script>
let deferredPrompt=null;

window.addEventListener('beforeinstallprompt',e=>{
e.preventDefault();
deferredPrompt=e;
});

document.getElementById("btnInstall").addEventListener("click",async()=>{
if(!deferredPrompt){
alert("La instalaciÃ³n no estÃ¡ disponible en este momento.");
return;
}
deferredPrompt.prompt();
await deferredPrompt.userChoice;
deferredPrompt=null;
});

function calcular(){
let total=0;
document.querySelectorAll(".price").forEach(i=>{
if(i.previousElementSibling.querySelector("input").checked){
total+=Number(i.value||0);
}
});
document.getElementById("total").innerText=total.toLocaleString();
guardarHistorial(total);
}

function guardarHistorial(total){
let data=JSON.parse(localStorage.getItem("historial")||"[]");
data.push({fecha:new Date().toLocaleString(),cliente:cliente.value,total});
localStorage.setItem("historial",JSON.stringify(data));
}

function verHistorial(){
let h=JSON.parse(localStorage.getItem("historial")||"[]");
if(!h.length){alert("Historial vacÃ­o");return;}
alert(h.map(x=>`${x.fecha} - ${x.cliente} - Gs. ${x.total}`).join("\n"));
}

function borrarHistorial(){
if(confirm("Â¿Borrar historial?")){
localStorage.removeItem("historial");
alert("Historial borrado");
}
}

function exportarCSV(){
let h=JSON.parse(localStorage.getItem("historial")||"[]");
if(!h.length){alert("Historial vacÃ­o");return;}
let csv="Fecha,Cliente,Total\n"+h.map(x=>`${x.fecha},${x.cliente},${x.total}`).join("\n");
let a=document.createElement("a");
a.href=URL.createObjectURL(new Blob([csv],{type:"text/csv"}));
a.download="historial.csv";
a.click();
}

function descargarPDF(){
window.print();
}

function enviarWhatsApp(){
let t=document.getElementById("total").innerText;
let msg=`Presupuesto GUAâ€™ÃŒ APP\nCliente: ${cliente.value}\nTotal: Gs. ${t}`;
window.open("https://wa.me/?text="+encodeURIComponent(msg));
}

function compartir(){
if(navigator.share){
navigator.share({title:"GUAâ€™ÃŒ APP",url:location.href});
}else{
alert("Compartir no soportado");
}
}

if('serviceWorker' in navigator){
navigator.serviceWorker.register('sw.js');
}
</script>

</body>
</html>
