<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>GUAâ€™Ä¨ APP | Presupuesto TÃ©cnico</title>

<link rel="manifest" href="manifiesto.json">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
/* ===== PRINT ===== */
@media print {
  .pdf-header{
    position: fixed;
    top: 0; left: 0; right: 0;
    background:#fff;
    z-index:1000;
  }
  #pdf{ padding-top:120px; }
}

/* ===== APP ===== */
body{margin:0;font-family:Arial;background:#f4f6f8}
.container{max-width:800px;margin:auto;background:#fff}
.header{background:#0b5ed7;color:#fff;text-align:center;padding:16px}
.header img{height:70px}
.card{margin:16px;padding:16px;border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,.1)}
input{width:100%;padding:8px;margin-top:6px}
button{width:100%;padding:14px;margin-top:10px;border:none;border-radius:8px;font-weight:bold}
.blue{background:#0b5ed7;color:#fff}
.green{background:#28a745;color:#fff}
.gray{background:#6c757d;color:#fff}
.footer{text-align:center;font-size:11px;color:#444;padding:20px}
.hidden{display:none}

/* ===== PDF ===== */
#pdf{
  width:216mm;
  min-height:356mm;
  padding:20mm;
  margin:0 auto;
  background:#fff;
  box-sizing:border-box;
  font-size:12px;
  color:#000;
}

.pdf-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.pdf-header img{height:60px}

.pdf-header h2{margin:0}

#pdf table{
  width:100%;
  border-collapse:collapse;
  margin-top:12px;
}

#pdf th,#pdf td{
  border:1px solid #333;
  padding:6px;
  font-size:11px;
}

#pdf th:nth-child(2),
#pdf td:nth-child(2){
  text-align:right;
  width:35%;
}

.total-final td{
  font-size:13px;
  font-weight:bold;
}
</style>
</head>

<body>

<div class="container">

  <div class="header">
    <img src="logotipo-guaiapp.png">
  </div>

  <div class="card">
    <input id="cliente" placeholder="Cliente">
    <input id="rucCliente" placeholder="RUC Cliente">
    <input id="telCliente" placeholder="TelÃ©fono Cliente">
    <input id="tecnico" placeholder="TÃ©cnico Responsable">
    <input id="empresa" placeholder="Empresa / Taller">
  </div>

  <div class="card">
    <input id="s1" placeholder="Mantenimiento preventivo Gs">
    <input id="s2" placeholder="Mantenimiento correctivo Gs">
    <input id="s3" placeholder="Carga de gas Gs">
    <input id="desc4" placeholder="Otro servicio">
    <input id="s4" placeholder="Precio otro servicio Gs">
  </div>

  <div class="card">
    <b>Subtotal:</b> Gs. <span id="sub">0</span><br>
    <b>IVA 10%:</b> Gs. <span id="iva">0</span><br>
    <b style="font-size:18px">Total:</b> Gs. <span id="total">0</span>
  </div>

  <div class="card">
    <button class="blue" onclick="calcular()">ðŸ”„ Calcular</button>
    <button class="green" onclick="downloadPDF()">ðŸ“„ Descargar PDF Profesional</button>
    <button class="gray" onclick="sendWhats()">ðŸ’¬ Enviar por WhatsApp</button>
    <button id="btnInstalar" class="gray" style="display:none">ðŸ“² Instalar App</button>
    <button class="gray" onclick="compartir()">ðŸ”— Compartir App</button>
  </div>

  <div class="footer">
    <b>GUAâ€™Ä¨ APP</b><br>
    RHAB Tech â€“ RHAB INTERNATIONAL TRADING<br>
    San Lorenzo â€“ Paraguay Â· Alberto SÃ¡nchez BenÃ­tez 9998<br>
    guaiapp@rhabinternationaltrading.com
  </div>
</div>

<!-- ================= PDF ================= -->
<div id="pdf" class="hidden">

  <div class="pdf-header">
    <img src="logotipo-guaiapp.png">
    <div>
      <h2>Presupuesto TÃ©cnico</h2>
      NÂ°: <span id="nPresupuesto"></span><br>
      Fecha: <span id="fecha"></span><br>
      VÃ¡lido hasta: <span id="vence"></span>
    </div>
  </div>

  <table>
    <tr><td>Cliente</td><td id="pcliente"></td></tr>
    <tr><td>RUC</td><td id="pruc"></td></tr>
    <tr><td>TelÃ©fono</td><td id="ptel"></td></tr>
    <tr><td>TÃ©cnico</td><td id="ptecnico"></td></tr>
    <tr><td>Empresa</td><td id="pempresa"></td></tr>
  </table>

  <table>
    <tr><th>DescripciÃ³n</th><th>Importe</th></tr>
    <tr><td>Mantenimiento preventivo</td><td id="ps1"></td></tr>
    <tr><td>Mantenimiento correctivo</td><td id="ps2"></td></tr>
    <tr><td>Carga de gas</td><td id="ps3"></td></tr>
    <tr><td id="pdesc4"></td><td id="ps4"></td></tr>
    <tr><td>Subtotal</td><td id="psub"></td></tr>
    <tr><td>IVA 10%</td><td id="piva"></td></tr>
    <tr class="total-final"><td>Total</td><td id="ptotal"></td></tr>
  </table>

  <p><b>GarantÃ­a:</b> 7 dÃ­as sobre el servicio realizado.</p>

</div>

<script>
function calcular(){
  let total=(+s1.value||0)+(+s2.value||0)+(+s3.value||0)+(+s4.value||0);
  let sub=Math.round(total/1.1);
  let iva=total-sub;
  sub.innerText=sub.toLocaleString("es-PY");
  iva.innerText=iva.toLocaleString("es-PY");
  total.innerText=total.toLocaleString("es-PY");
}

function downloadPDF(){
  calcular();
  const n="GUA-"+Date.now();
  const f=new Date();
  const v=new Date(); v.setDate(f.getDate()+7);

  nPresupuesto.innerText=n;
  fecha.innerText=f.toLocaleDateString("es-PY");
  vence.innerText=v.toLocaleDateString("es-PY");

  pcliente.innerText=cliente.value;
  pruc.innerText=rucCliente.value;
  ptel.innerText=telCliente.value;
  ptecnico.innerText=tecnico.value;
  pempresa.innerText=empresa.value;

  ps1.innerText=s1.value;
  ps2.innerText=s2.value;
  ps3.innerText=s3.value;
  pdesc4.innerText=desc4.value;
  ps4.innerText=s4.value;

  psub.innerText=sub.innerText;
  piva.innerText=iva.innerText;
  ptotal.innerText=total.innerText;

  pdf.classList.remove("hidden");

  html2pdf().set({
    margin:[8,8,10,8],
    filename:"Presupuesto_"+n+".pdf",
    jsPDF:{unit:"mm",format:[216,356],orientation:"portrait"}
  }).from(pdf).save().then(()=>pdf.classList.add("hidden"));
}

function sendWhats(){
  const msg=`ðŸ“„ PRESUPUESTO GUAâ€™Ä¨ APP%0ACliente: ${cliente.value}%0ATotal: Gs. ${total.innerText}`;
  window.open("https://wa.me/?text="+msg,"_blank");
}

function compartir(){
  navigator.share?navigator.share({title:"GUAâ€™Ä¨ APP",url:location.href}):alert("No disponible");
}

if("serviceWorker"in navigator){navigator.serviceWorker.register("sw.js");}
</script>

</body>
</html>
