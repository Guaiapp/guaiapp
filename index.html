<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>GUAâ€™Ä¨ APP | Empresa</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0b5ed7">

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
:root{
  --primary:#0b5ed7;
  --bg:#f4f6f8;
  --card:#ffffff;
  --text:#333;
}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,Arial;background:var(--bg);color:var(--text)}
header{background:var(--primary);text-align:center;padding:20px}
header img{width:260px;max-width:90%}
header h1{color:#fff;font-size:16px;margin:12px 0 0}
.container{padding:16px}
.card{
  background:var(--card);
  border-radius:14px;
  padding:16px;
  margin-bottom:16px;
  box-shadow:0 2px 8px rgba(0,0,0,.08)
}
.card h2{font-size:15px;color:var(--primary);margin-bottom:10px}
input,select{
  width:100%;
  padding:10px;
  margin-top:6px;
  border-radius:8px;
  border:1px solid #ccc
}
table{width:100%;border-collapse:collapse;font-size:13px}
th{background:var(--primary);color:#fff;padding:8px}
td{border:1px solid #ddd;padding:8px}
.total{font-weight:700;background:#f1f1f1}
.btn{
  width:100%;
  padding:14px;
  margin-top:10px;
  background:var(--primary);
  color:#fff;
  border:none;
  border-radius:12px;
  font-size:15px;
  font-weight:600
}
.gray{background:#6c757d}
.green{background:#28a745}
.wa{background:#25D366}
footer{text-align:center;font-size:12px;color:#555;padding:16px}
ul{padding-left:18px}
</style>
</head>

<body>

<header>
  <img src="logo-guaiapp.png">
  <h1>PRESUPUESTO TÃ‰CNICO DE SERVICIOS DE CLIMATIZACIÃ“N</h1>
</header>

<div class="container" id="contenidoPDF">

<!-- CONFIG EMPRESA -->
<div class="card">
<h2>Identidad Empresa / TÃ©cnico</h2>
<input id="empresa" placeholder="Empresa o TÃ©cnico">
<input id="telefono" placeholder="TelÃ©fono">
<input id="email" placeholder="Email">
<button class="btn gray" onclick="guardarEmpresa()">Guardar identidad</button>
</div>

<!-- DATOS -->
<div class="card">
<h2>Datos del Presupuesto</h2>
<input id="cliente" placeholder="Cliente">
<input id="direccion" placeholder="DirecciÃ³n del servicio">
</div>

<!-- SERVICIOS -->
<div class="card">
<h2>Detalle de trabajos</h2>
<table id="tabla">
<tr><th>#</th><th>DescripciÃ³n</th><th>Monto Gs.</th></tr>
<tr>
<td>1</td>
<td><input placeholder="Servicio"></td>
<td><input type="number" oninput="calcular()"></td>
</tr>
<tr>
<td>2</td>
<td><input placeholder="Servicio"></td>
<td><input type="number" oninput="calcular()"></td>
</tr>
<tr>
<td>3</td>
<td><input placeholder="Servicio"></td>
<td><input type="number" oninput="calcular()"></td>
</tr>
<tr class="total">
<td colspan="2">TOTAL</td>
<td id="total">0</td>
</tr>
</table>

<input id="descuento" type="number" placeholder="Descuento Gs." oninput="calcular()">
<label><input type="checkbox" id="iva" onchange="calcular()"> Aplicar IVA 10%</label>
</div>

<!-- ACCIONES -->
<div class="card">
<button class="btn" onclick="calcular()">Calcular total</button>
<button class="btn green" onclick="descargarPDF()">Descargar PDF</button>
<button class="btn wa" onclick="enviarWhatsApp()">Enviar por WhatsApp</button>
<button class="btn gray" onclick="instalarApp()">ðŸ“² Instalar App</button>
<button class="btn gray" onclick="compartirApp()">ðŸ”— Compartir App</button>
</div>

<!-- HISTORIAL -->
<div class="card">
<h2>Historial Empresa</h2>
<button class="btn gray" onclick="verHistorial()">Ver historial</button>
<button class="btn gray" onclick="exportarCSV()">Exportar CSV</button>
<button class="btn gray" onclick="borrarHistorial()">Borrar historial</button>
<ul id="historial"></ul>
</div>

</div>

<footer>
<strong>Generado a travÃ©s de GUAâ€™Ä¨ APP</strong><br>
Plataforma digital de presupuestos tÃ©cnicos de climatizaciÃ³n<br>
Desarrollado por RHAB Tech â€“ RHAB INTERNATIONAL TRADING<br>
guaiapp@rhabinternationaltrading.com Â· info@rhabinternationaltrading.com
</footer>

<script>
/* ===== IDENTIDAD ===== */
function guardarEmpresa(){
  localStorage.setItem("guai_empresa",JSON.stringify({
    empresa:empresa.value,
    telefono:telefono.value,
    email:email.value
  }));
  alert("Identidad guardada");
}
(function cargarEmpresa(){
  const e=JSON.parse(localStorage.getItem("guai_empresa")||"{}");
  empresa.value=e.empresa||"";
  telefono.value=e.telefono||"";
  email.value=e.email||"";
})();

/* ===== NUMERACIÃ“N ===== */
let nro = Number(localStorage.getItem("guai_nro")||0)+1;
localStorage.setItem("guai_nro",nro);

/* ===== CALCULO ===== */
function calcular(){
  let suma=0;
  document.querySelectorAll("table input[type=number]").forEach(i=>{
    suma+=Number(i.value||0);
  });
  const d=Number(descuento.value||0);
  suma-=d;
  if(iva.checked) suma+=suma*0.10;
  total.innerText=Math.round(suma);
}

/* ===== PDF ===== */
function descargarPDF(){
  html2pdf().set({
    filename:`GUA-${new Date().getFullYear()}-${String(nro).padStart(5,"0")}.pdf`,
    html2canvas:{scale:2},
    jsPDF:{format:"a4"}
  }).from(document.getElementById("contenidoPDF")).save();
  guardarHistorial();
}

/* ===== WHATSAPP ===== */
function enviarWhatsApp(){
  const e=JSON.parse(localStorage.getItem("guai_empresa")||"{}");
  let msg=
`PRESUPUESTO TÃ‰CNICO DE CLIMATIZACIÃ“N
Emitido por: ${e.empresa||""}
Generado con GUAâ€™Ä¨ APP

Cliente: ${cliente.value}
DirecciÃ³n: ${direccion.value}
TOTAL: Gs. ${total.innerText}`;
  window.open("https://wa.me/?text="+encodeURIComponent(msg));
}

/* ===== HISTORIAL ===== */
function guardarHistorial(){
  const h=JSON.parse(localStorage.getItem("guai_historial")||"[]");
  h.push({
    nro,
    fecha:new Date().toLocaleString(),
    cliente:cliente.value,
    total:total.innerText
  });
  localStorage.setItem("guai_historial",JSON.stringify(h));
}
function verHistorial(){
  historial.innerHTML="";
  const h=JSON.parse(localStorage.getItem("guai_historial")||"[]");
  h.slice().reverse().forEach(i=>{
    historial.innerHTML+=`<li>#${i.nro} | ${i.fecha} | ${i.cliente} | Gs. ${i.total}</li>`;
  });
}
function borrarHistorial(){
  if(confirm("Â¿Borrar historial?")){
    localStorage.removeItem("guai_historial");
    historial.innerHTML="";
  }
}
function exportarCSV(){
  const h=JSON.parse(localStorage.getItem("guai_historial")||"[]");
  let csv="Nro,Fecha,Cliente,Total\n";
  h.forEach(i=>csv+=`${i.nro},${i.fecha},${i.cliente},${i.total}\n`);
  const a=document.createElement("a");
  a.href=URL.createObjectURL(new Blob([csv],{type:"text/csv"}));
  a.download="historial_guaiapp.csv";
  a.click();
}

/* ===== PWA ===== */
let deferredPrompt;
window.addEventListener("beforeinstallprompt",e=>{
  e.preventDefault();
  deferredPrompt=e;
});
function instalarApp(){
  if(deferredPrompt) deferredPrompt.prompt();
}
function compartirApp(){
  navigator.share?
  navigator.share({title:"GUAâ€™Ä¨ APP",url:location.href}):
  alert(location.href);
}
</script>

</body>
</html>
